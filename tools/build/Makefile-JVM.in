GEN_OBJ = $(PERL) tools/build/mv.pl
GEN_PERL6_IR_ARGS = --javaclass=perl6
GEN_RUNNER = $(PERL) tools/build/create-jvm-runner.pl dev . $(NQP_PREFIX) $(NQP_JARS)
GEN_B_IR = $(PERL) tools/build/nqp-jvm-rr.pl
VMLIBS =
VM = jvm
IR = jar
IREXT = .$(IR)
BCEXT = $(IREXT)
LIB = lib
TEST_BLIB = $(BLIB)
BLIB = blib
RUNTIME_DIR = runtime
PERL6_LANG_DIR_PREFIX = $(PREFIX)
PERL6_RUNTIME_DIR = $(RUNTIME_DIR)
RUN_PERL6 = $(JAVA) -Xms500m -Xmx2g -Xbootclasspath/a:.@cpsep@$(NQP_JARS)@cpsep@rakudo-runtime.jar@cpsep@perl6.jar -cp $(NQP_PREFIX) perl6
HARNESS_ARGS = --jvm
VM_REVISION_ARGS =
VM_RUNTIME_OBJ = rakudo-runtime.jar
VM_DYNOPS =
VM_METAMODEL_SOURCES =
VM_CLEANUPS = \
  $(BLIB)/Perl6/*.jar \
  bin \
  $(VM_RUNTIME_OBJ)

JAVA    = java
JAVAC   = javac
JAR     = jar

PREFIX = @prefix@
NQP_PREFIX = @nqp_prefix@

NQP_JARS = $(NQP_PREFIX)/nqp-runtime.jar@cpsep@$(NQP_PREFIX)/asm-4.1.jar@cpsep@$(NQP_PREFIX)/asm-tree-4.1.jar@cpsep@$(NQP_PREFIX)/jline-1.0.jar

RUNTIME_JAVAS = src/vm/jvm/runtime/org/perl6/rakudo/*.java

$(VM_RUNTIME_OBJ): $(RUNTIME_JAVAS)
	$(MKPATH) bin
	$(JAVAC) -source 1.7 -cp $(NQP_JARS) -g -d bin $(RUNTIME_JAVAS)
	$(JAR) cf0 $(VM_RUNTIME_OBJ) -C bin/ .

#spectest_smolder: rakudo_test_run.tar.gz
#	./perl6 -e "shell qqx[git log -1 --pretty=format:%H].fmt(qq[curl -F architecture=@cpuarch@ -F platform=@osname@ -F revision=%s -F report_file=@rakudo_test_run.tar.gz -F username=parrot-autobot -F password=qa_rocks http://smolder.parrot.org/app/projects/process_add_report/5])"

install: tools/build/create-jvm-runner.pl install-general
	$(MKPATH) $(PREFIX)/bin
	$(CP) $(RUNTIME_JAR) $(PERL6_LANG_DIR)/$(RUNTIME_DIR)
	$(PERL) tools/build/create-jvm-runner.pl install $(PREFIX) $(NQP_PREFIX) $(NQP_JARS)

# nqp::makefile
